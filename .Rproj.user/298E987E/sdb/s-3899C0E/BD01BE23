{
    "collab_server" : "",
    "contents" : "################################################################################\n#\n# Model incorporating both thresholds and network dynamics\n#\n################################################################################\n\nrm(list = ls())\nsource(\"scripts/__Util__MASTER.R\")\n\n\n####################\n# Set global variables\n####################\n# Initial paramters: Free to change\n# Base parameters\nNs             <- c(100) #vector of number of individuals to simulate\nm              <- 2 #number of tasks\ngens           <- 10000 #number of generations to run simulation \ncorrStep       <- 200 #number of time steps for calculation of correlation \nreps           <- 1 #number of replications per simulation (for ensemble)\n\n# Threshold Parameters\nThreshM        <- rep(10, m) #population threshold means \nThreshSD       <- ThreshM * 0.01 #population threshold standard deviations\nInitialStim    <- rep(0, m) #intital vector of stimuli\ndeltas         <- rep(0.6, m) #vector of stimuli increase rates  \nalpha          <- m #efficiency of task performance\nquitP          <- 0.2 #probability of quitting task once active\n\n# Social Network Parameters\nepsilon        <- 0.01 #relative weighting of social interactions for lowering thresholds #0.01 = epsilon = phi\nphi            <- 0.01 #default forgetting rate of thresholds\np              <- 0.1 #probability of interacting with individual in other states\nq              <- 1.1 #probability of interacting with individual in same state relative to others\n\n\n\n####################\n# Run simulation multiple times\n####################\n\n# Loop through group sizes\nfor (i in 1:length(Ns)) {\n  # Set group size\n  n <- Ns[i]\n  \n  # Run Simulations\n  for (sim in 1:reps) {\n    \n    ####################\n    # Seed structures and intial matrices\n    ####################\n\n    # Set initial probability matrix (P_g)\n    P_g <- matrix(data = rep(0, n * m), ncol = m)\n    \n    # Seed task (external) stimuli\n    stimMat <- seedStimuls(InitialSVector = InitialStim, \n                           gens = gens)\n    \n    # Seed internal thresholds\n    threshMat <- seedThresholds(n = n, \n                                m = m, \n                                ThresholdMeans = ThreshM, \n                                ThresholdSDs = ThreshSD)\n    \n    # Start task performance\n    X_g <- matrix(data = rep(0, length(P_g)), ncol = ncol(P_g))\n    \n    # Create cumulative task performance matrix\n    X_tot <- X_g\n    \n    # Create cumulative adjacency matrix\n    g_tot <-  matrix(data = rep(0, n * n), ncol = n)\n    colnames(g_tot) <- paste0(\"v-\", 1:n)\n    rownames(g_tot) <- paste0(\"v-\", 1:n)\n    \n    # Prep correlation tracking matrix\n    thresh1time <- list()\n    thresh2time <- list()\n    thresh1time[[1]] <- threshMat[,1]\n    thresh2time[[2]] <- threshMat[,2]\n    \n    ####################\n    # Simulate\n    ####################\n    # Run simulation\n    for (t in 1:gens) {\n      # Update stimuli\n      for (j in 1:ncol(stimMat)) {\n        # update stim\n        stimMat[t + 1, j] <- globalStimUpdate(stimulus = stimMat[t, j],\n                                              delta = deltas[j], \n                                              alpha = alpha, \n                                              Ni = sum(X_g[ , j]), \n                                              n = n)\n      }\n      # Calculate task demand based on global stimuli\n      P_g <- calcThresholdDetermMat(TimeStep = t + 1, # first row is generation 0\n                                    ThresholdMatrix = threshMat, \n                                    StimulusMatrix = stimMat)\n      # Update task performance\n      X_g <- updateTaskPerformance(P_sub_g    = P_g,\n                                   TaskMat    = X_g,\n                                   QuitProb   = quitP)\n      # Update social network (previously this was before probability/task update)\n      g_adj <- temporalNetwork(X_sub_g = X_g,\n                               bias = q)\n      g_tot <- g_tot + g_adj\n      # Adjust thresholds\n      threshMat <- adjustThresholdsSocial(SocialNetwork = g_adj,\n                                          ThresholdMatrix = threshMat, \n                                          X_sub_g = X_g, \n                                          epsilon = epsilon, \n                                          phi = phi)\n      thresh1time[[t + 1]] <- threshMat[,1]\n      thresh2time[[t + 1]] <- threshMat[,2]\n      \n      # Update total task performance profile\n      X_tot <- X_tot + X_g\n      \n    }\n\n    # Print simulation completed\n    print(paste0(\"DONE: N = \", n, \", Simulation \", sim))\n  }\n  \n}\n\nlibrary(RColorBrewer)\nlibrary(scales)\nlibrary(tidyr)\nlibrary(ggthemes)\n\nthresh1time <- do.call(\"rbind\", thresh1time)\nrow.names(thresh1time) <- NULL\nthresh1time <- as.data.frame(thresh1time)\nthresh1time <- thresh1time %>% \n  mutate(t = 0:(nrow(.)-1)) %>% \n  gather(\"Id\", \"Threshold\", 1:100)\n\nthreshMat <- threshMat %>% \n  as.data.frame(.) %>% \n  mutate(ThreshRatio = log(Thresh1 / Thresh2),\n         Id = row.names(.)) %>% \n  select(-Thresh1, -Thresh2)\n\nthresh1time <- merge(thresh1time, threshMat, by = \"Id\")\nthresh1time$ThreshRatio[thresh1time$ThreshRatio > 10] <- 10\nthresh1time$ThreshRatio[thresh1time$ThreshRatio < -10] <- -10\n\n\n# base_breaks_x <- function(x){\n#   b <- pretty(x)\n#   adjust_for_ticks <- max(b) * 0.0025\n#   d <- data.frame(y=-Inf, yend=-Inf, x=min(b) - adjust_for_ticks, xend=max(b) + adjust_for_ticks)\n#   list(geom_segment(data=d, aes(x=x, y=y, xend=xend, yend=yend),size = 1, inherit.aes=FALSE),\n#        scale_x_continuous(breaks=b))\n# }\n# base_breaks_y <- function(x){\n#   b <- pretty(x)\n#   adjust_for_ticks <- max(b) * 0.0025\n#   d <- data.frame(x = -Inf, xend = -Inf, y=min(b) - adjust_for_ticks, yend = max(b) + adjust_for_ticks)\n#   list(geom_segment(data=d, aes(x = x, y = y, xend = xend, yend = yend), size = 1, inherit.aes = FALSE),\n#        scale_y_continuous(breaks=b))\n# }\n# \n# test <- thresh1time[thresh1time$Id %in% c(\"v-22\", \"v-20\", \"v-25\", \"v-40\"),]\n# gg_thresh <- ggplot(data = thresh1time, \n#                     aes(x = t, y = Threshold)) +\n#   theme_bw(base_size = 10) +\n#   geom_line(aes(group = Id, colour = ThreshRatio), size = 0.5) +\n#   scale_colour_gradient2(name = \"ln(Threshold Ratio)\",\n#                          high = \"#d7191c\",\n#                          mid = \"#cecece\", \n#                          low = \"#2c7bb6\", \n#                          midpoint = 0, \n#                          limits = c(-2, 2),\n#                          oob = squish) +\n#   base_breaks_x(thresh1time$t) +\n#   base_breaks_y(thresh1time$Threshold) +\n#   theme(aspect.ratio = 1,\n#         panel.border = element_blank(),\n#         panel.grid.major = element_blank(),\n#         panel.grid.minor = element_blank(),\n#         legend.position = \"none\",\n#         axis.ticks.length = unit(4, \"pt\"),\n#         axis.text = element_text(color = \"black\"))\n# gg_thresh\n\n\ngg_thresh <- ggplot(data = thresh1time, \n                    aes(x = t, y = Threshold)) +\n  theme_classic(base_size = 10) +\n  geom_line(aes(group = Id, colour = ThreshRatio), size = 0.5) +\n  scale_colour_gradient2(name = \"ln(Threshold Ratio)\",\n                         high = \"#d7191c\",\n                         mid = \"#ffffbf\", \n                         # mid = \"#cecece\", \n                         low = \"#2c7bb6\", \n                         midpoint = 0, \n                         limits = c(-1, 1),\n                         oob = squish) +\n  scale_y_continuous(limits = c(4, 16), breaks = seq(0,20, 5)) +\n  theme(aspect.ratio = 1,\n        panel.border = element_blank(),\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank(),\n        legend.position = \"none\",\n        axis.ticks.length = unit(4, \"pt\"),\n        axis.text = element_text(color = \"black\"))\ngg_thresh\n\nggsave(\"output/ThresholdTime/Size100test.png\", scale = 0.6, dpi = 600)\n",
    "created" : 1512438957204.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1430702764",
    "id" : "BD01BE23",
    "lastKnownWriteTime" : 1512506488,
    "last_content_update" : 1512506488751,
    "path" : "~/Documents/Research/Tarnita Lab/Social Interaction DOL/SocialModel/scripts/1_SocThreshModel_TrackThresh.R",
    "project_path" : "scripts/1_SocThreshModel_TrackThresh.R",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}